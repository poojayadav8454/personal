{% schema %}
{
  "name": "Tabbed Collections",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Featured Collections"
    }
  ],
  "blocks": [
    {
      "type": "collection_tab",
      "name": "Collection Tab",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Select Collection"
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [{
    "name": "Tabbed Collections",
    "category": "Custom"
  }]
}
{% endschema %}

<div class="tabbed-collections">
  <h2>{{ section.settings.title }}</h2>

  <ul class="tabs">
    {% for block in section.blocks %}
      <li class="tab {% if forloop.first %}active{% endif %}" data-tab="tab-{{ forloop.index }}">
        {{ block.settings.collection.title }}
      </li>
    {% endfor %}
  </ul>

  <div class="tab-content">
    {% for block in section.blocks %}
      <div class="tab-pane {% if forloop.first %}active{% endif %}" id="tab-{{ forloop.index }}">
        <div class="products-grid">
          {% for product in block.settings.collection.products limit: 8 %}
            <div class="product-item">
              <a href="{{ product.url }}">
                <img src="{{ product.featured_image | img_url: '300x300' }}" alt="{{ product.title }}">
                <p>{{ product.title }}</p>
              </a>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<style>
.tabs { display: flex; gap: 1rem; cursor: pointer; margin-bottom: 20px; }
.tab { padding: 10px 20px; border: 1px solid #ccc; }
.tab.active { background: #000; color: white; }
.tab-pane { display: none; }
.tab-pane.active { display: block; }
.products-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const tabs = document.querySelectorAll('.tab');
  const panes = document.querySelectorAll('.tab-pane');

  tabs.forEach((tab, index) => {
    tab.addEventListener('click', () => {
      // Remove active from all
      tabs.forEach(t => t.classList.remove('active'));
      panes.forEach(p => p.classList.remove('active'));

      // Add active to clicked
      tab.classList.add('active');
      panes[index].classList.add('active');
    });
  });
});
</script>
